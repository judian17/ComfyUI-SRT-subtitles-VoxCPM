{"id":"4bc17af4-95a1-40da-983a-0ab9e137630e","revision":0,"last_node_id":69,"last_link_id":118,"nodes":[{"id":46,"type":"VoxCPM_Cache_Combiner","pos":[164.34424221558984,695.1053671230557],"size":[279.5611328125,46],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"cache_item","name":"cache_item","type":"VOXCPM_CACHE","link":70},{"localized_name":"cache_group","name":"cache_group","shape":7,"type":"CACHE_GROUP","link":100}],"outputs":[{"localized_name":"CACHE_GROUP","name":"CACHE_GROUP","type":"CACHE_GROUP","links":[71]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Combiner"},"widgets_values":[]},{"id":47,"type":"VoxCPM_Cache_Combiner","pos":[151.41410935064854,953.5093897967492],"size":[279.5611328125,46],"flags":{},"order":14,"mode":0,"inputs":[{"localized_name":"cache_item","name":"cache_item","type":"VOXCPM_CACHE","link":72},{"localized_name":"cache_group","name":"cache_group","shape":7,"type":"CACHE_GROUP","link":71}],"outputs":[{"localized_name":"CACHE_GROUP","name":"CACHE_GROUP","type":"CACHE_GROUP","links":[110]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Combiner"},"widgets_values":[]},{"id":35,"type":"VoxCPM_Loader","pos":[-900.807891936352,931.7093511956764],"size":[270,106],"flags":{},"order":0,"mode":0,"inputs":[{"localized_name":"model_name","name":"model_name","type":"COMBO","widget":{"name":"model_name"},"link":null},{"localized_name":"optimize","name":"optimize","type":"BOOLEAN","widget":{"name":"optimize"},"link":null}],"outputs":[{"localized_name":"VOXCPM_MODEL","name":"VOXCPM_MODEL","type":"VOXCPM_MODEL","links":[53,54,61,109]}],"properties":{"Node name for S&R":"VoxCPM_Loader"},"widgets_values":["VoxCPM-0.5B",false]},{"id":63,"type":"LoadAudio","pos":[-920.5181435221646,621.1378843539596],"size":[270,136],"flags":{},"order":1,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[112]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["long.mp3",null,null]},{"id":59,"type":"Audio_Trimmer_By_Timestamp","pos":[-932.3992815930536,513.3995984156861],"size":[291.7779296875,58],"flags":{},"order":7,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":103},{"localized_name":"timestamp","name":"timestamp","type":"STRING","widget":{"name":"timestamp"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[106]}],"properties":{"Node name for S&R":"Audio_Trimmer_By_Timestamp"},"widgets_values":["00:00:07,050 --> 00:00:11,760"]},{"id":40,"type":"VoxCPM_Cache_Builder","pos":[-300.82574592565413,959.2944824097431],"size":[400,200],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":61},{"localized_name":"prompt_audio","name":"prompt_audio","type":"AUDIO","link":113},{"localized_name":"speaker_name","name":"speaker_name","type":"STRING","widget":{"name":"speaker_name"},"link":null},{"localized_name":"prompt_text","name":"prompt_text","type":"STRING","widget":{"name":"prompt_text"},"link":null}],"outputs":[{"localized_name":"VOXCPM_CACHE","name":"VOXCPM_CACHE","type":"VOXCPM_CACHE","links":[72]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Builder"},"widgets_values":["speaker2","傻子不是人哪？傻子不是爹妈养的？",[false,true]]},{"id":64,"type":"Audio_Trimmer_By_Timestamp","pos":[-922.2139264571124,813.0775263538757],"size":[291.7779296875,58],"flags":{},"order":6,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":112},{"localized_name":"timestamp","name":"timestamp","type":"STRING","widget":{"name":"timestamp"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[113]}],"properties":{"Node name for S&R":"Audio_Trimmer_By_Timestamp"},"widgets_values":["00:00:22,750 --> 00:00:27,060"]},{"id":58,"type":"LoadAudio","pos":[-927.9602260037702,314.94771162267523],"size":[270,136],"flags":{},"order":2,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[103]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["1-你骂我是你有病-1080P 高清-AVC.mp3",null,null]},{"id":56,"type":"LoadAudio","pos":[-919.542028720829,1117.041722961764],"size":[270,136],"flags":{},"order":3,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[115]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["1-马保国原版视频-1080P 高清-AVC.mp3",null,null]},{"id":36,"type":"VoxCPM_Cache_Builder","pos":[-290.2926212926575,675.7631801503205],"size":[400,200],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":54},{"localized_name":"prompt_audio","name":"prompt_audio","type":"AUDIO","link":106},{"localized_name":"speaker_name","name":"speaker_name","type":"STRING","widget":{"name":"speaker_name"},"link":null},{"localized_name":"prompt_text","name":"prompt_text","type":"STRING","widget":{"name":"prompt_text"},"link":null}],"outputs":[{"localized_name":"VOXCPM_CACHE","name":"VOXCPM_CACHE","type":"VOXCPM_CACHE","links":[70]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Builder"},"widgets_values":["曼波","我骂你，你没有病我能骂你吗？对不对？咱讲道理是不是。",[false,true]]},{"id":57,"type":"SaveAudio","pos":[981.6580215509886,461.00310065098444],"size":[270,112],"flags":{},"order":16,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"AUDIO","link":111},{"localized_name":"文件名前缀","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"SaveAudio"},"widgets_values":["audio/editor"]},{"id":66,"type":"SaveAudio","pos":[998.2781740790934,694.7380989280372],"size":[264.99607441785724,112],"flags":{},"order":17,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"AUDIO","link":117},{"localized_name":"文件名前缀","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"SaveAudio"},"widgets_values":["audio/editor"]},{"id":69,"type":"SaveAudio","pos":[998.9971124047973,881.3805975598146],"size":[269.4440082686508,112],"flags":{},"order":18,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"AUDIO","link":118},{"localized_name":"文件名前缀","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"SaveAudio"},"widgets_values":["audio/editor"]},{"id":22,"type":"Note","pos":[-205.06952167096082,154.94727490432595],"size":[603.9952486578943,234.30141862920652],"flags":{},"order":4,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["VoxCPM loader节点的optimize参数用于启用torch compiler，但是直接用用不了，可能Linux能用吧故保留。\n\nVoxCPM cache builder的speaker_name 为手动输入说话人编号，与srt文件中每句话前对应的说话人一致。文本输入框中输入参考音频的说话内容。输出的voxcpm_cache 连接到vocpm cache combiner节点，此节点可以复制不断串联以增加说话人。第一个节点的cache_group不需要输入，后续每一个的输入与前一个输出相连，最后一个连到srt processor节点。srt字幕中的每句话前请使用 字符串+空格的格式区分说话人，例如：\n1\n00:00:00,500 --> 00:00:05,000\nspeaker1 Hello world！\n\n2\n00:00:06,500 --> 00:00:08,000\n说话人 你好，世界！\n\n当想处理单人srt字幕时，srt字幕中文本不需要加说话人前缀。例如：\n1\n00:00:00,500 --> 00:00:05,000\nHello world！\n\n2\n00:00:06,500 --> 00:00:08,000\n你好，世界！\n\n\n可使用 comfyui \"加载音频\"节点加载参考音频输入给cache builder节点，也可加载完整长音频，输入给 audio trimmer by timestamp节点，在节点上输入形如00:00:06,500 --> 00:00:08,000的时间戳文本，即可仅输出此时间段的音频。\n\nentries to replace输入srt中字幕编号，以空格隔开，代表利用输入音色与对应字幕文本生成新音频，并替换到原位置以替换音色。也可同步修改字幕文本以替换说话内容。注意，数字代表字幕编号，而非字幕顺序，虽然规范字幕它们是一回事，但是不规范字幕，例如1 2 3 5 6，如果输入编号4并不会识别到第四个字幕。而如果是 1 2 3 4 4 5，则输入4会处理两个4编号对应字幕的文本。\n\nnormalize text参数用于正则化文本，例如输入数字50时，不开启可能会读成五零，开启可读成五十。\n\nstretch method的三种模式：\n  none代表不加速音频，当生成音频超出原始时间段长度，与下一句重合时，两句话会同时存在；\n  librosa 代表使用librosa加速音频使其长度与文本时长一致。此加速方法效果时好时坏，可通过调整stretch n fft与 stretch hop length来改善“金属声”等效果。\n  pydub 代表使用pydub方法加速音频使其长度与文本时长一致。此方法效果略好于librosa，但需要下载ffmpeg并设置环境变量，本方法本质是借助ffmpeg处理音频。ffmpeg安装及环境变量设置可参考此处：https://blog.csdn.net/Natsuago/article/details/143231558\n\n\n默认CFG=2比较正常一些，较大的CFG虽然在某些情况下能够提升生成的following效果，但是会导致潜在的不稳定性，详情可见项目作者的技术报告中关于CFG的实验部分：https://arxiv.org/pdf/2509.24650\n\ninference timesteps 10步即可有较好效果，增加步数可得到更好的效果\n\nretry_threshold (重试阈值):这是触发重试的条件。voxcpm 会比较生成音频的长度和输入文本的长度。如果生成的音频相对于文本来说“过长”，模型就认为自己“卡住”了（即在“胡言乱语”）。如果参考音频为一个语速非常慢的说话人（例如戏剧性的停顿）生成语音，可能需要调高这个值（比如到 8.0 或 10.0），以防止模型误以为正常的慢速语音是“坏”的。\nretry_max_attempts (最大重试次数):这是在触发“坏情况”后，模型允许自己重试多少次。当 audio_text_ratio 超过 retry_threshold 时，模型会丢弃这一次生成的坏音频，并从头开始（使用不同的随机性）为同一句文本再次尝试生成。\n\n何时调整： 默认值 3 通常足够了。如果设为 0，则会禁用此功能（即使检测到坏情况也不会重试）。\n\n"],"color":"#432","bgcolor":"#653"},{"id":6,"type":"LoadAudio","pos":[-594.0373445655939,442.9596959679873],"size":[270,136],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[52]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["可莉3.mp3",null,null]},{"id":65,"type":"Audio_Trimmer_By_Timestamp","pos":[-622.5169103882828,1175.9451706457376],"size":[291.7779296875,58],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":115},{"localized_name":"timestamp","name":"timestamp","type":"STRING","widget":{"name":"timestamp"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[116]}],"properties":{"Node name for S&R":"Audio_Trimmer_By_Timestamp"},"widgets_values":["00:00:00,000 --> 00:00:15,615"]},{"id":37,"type":"VoxCPM_Cache_Builder","pos":[-291.4597204962041,459.18432359493795],"size":[402.01824998479754,137],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":53},{"localized_name":"prompt_audio","name":"prompt_audio","type":"AUDIO","link":52},{"localized_name":"speaker_name","name":"speaker_name","type":"STRING","widget":{"name":"speaker_name"},"link":null},{"localized_name":"prompt_text","name":"prompt_text","type":"STRING","widget":{"name":"prompt_text"},"link":null}],"outputs":[{"localized_name":"VOXCPM_CACHE","name":"VOXCPM_CACHE","type":"VOXCPM_CACHE","links":[69]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Builder"},"widgets_values":["speaker1","西风骑士团火花骑士可莉，前来报到！",[false,true]]},{"id":45,"type":"VoxCPM_Cache_Combiner","pos":[142.79055584028035,486.8177198192367],"size":[279.5611328125,46],"flags":{},"order":12,"mode":0,"inputs":[{"localized_name":"cache_item","name":"cache_item","type":"VOXCPM_CACHE","link":69},{"localized_name":"cache_group","name":"cache_group","shape":7,"type":"CACHE_GROUP","link":null}],"outputs":[{"localized_name":"CACHE_GROUP","name":"CACHE_GROUP","type":"CACHE_GROUP","links":[100]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Combiner"},"widgets_values":[]},{"id":62,"type":"VoxCPM_SRT_Dubber","pos":[470.6360213716977,449.7282701257604],"size":[449.24866337903427,688.9127287819466],"flags":{},"order":15,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":109},{"localized_name":"cache_group","name":"cache_group","type":"CACHE_GROUP","link":110},{"localized_name":"original_audio","name":"original_audio","type":"AUDIO","link":116},{"localized_name":"srt_text","name":"srt_text","type":"STRING","widget":{"name":"srt_text"},"link":null},{"localized_name":"entries_to_replace","name":"entries_to_replace","type":"STRING","widget":{"name":"entries_to_replace"},"link":null},{"localized_name":"normalize_text","name":"normalize_text","type":"BOOLEAN","widget":{"name":"normalize_text"},"link":null},{"localized_name":"stretch_method","name":"stretch_method","type":"COMBO","widget":{"name":"stretch_method"},"link":null},{"localized_name":"keep_model_loaded","name":"keep_model_loaded","type":"BOOLEAN","widget":{"name":"keep_model_loaded"},"link":null},{"localized_name":"stretch_n_fft","name":"stretch_n_fft","type":"INT","widget":{"name":"stretch_n_fft"},"link":null},{"localized_name":"stretch_hop_length","name":"stretch_hop_length","type":"INT","widget":{"name":"stretch_hop_length"},"link":null},{"localized_name":"cfg_value","name":"cfg_value","type":"FLOAT","widget":{"name":"cfg_value"},"link":null},{"localized_name":"inference_timesteps","name":"inference_timesteps","type":"INT","widget":{"name":"inference_timesteps"},"link":null},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null},{"localized_name":"retry_max_attempts","name":"retry_max_attempts","type":"INT","widget":{"name":"retry_max_attempts"},"link":null},{"localized_name":"retry_threshold","name":"retry_threshold","type":"FLOAT","widget":{"name":"retry_threshold"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[111,117,118]}],"properties":{"Node name for S&R":"VoxCPM_SRT_Dubber"},"widgets_values":["1\n00:00:02,441 --> 00:00:03,615\n朋友们好\n\n2\n00:00:03,620 --> 00:00:06,590\nspeaker1 我是混元形意太极拳掌门人马保国\n\n3\n00:00:06,686 --> 00:00:08,141\nspeaker1 刚才有个朋友问我\n\n4\n00:00:08,140 --> 00:00:09,538\n曼波 马老师发生什么事了\n\n5\n00:00:09,667 --> 00:00:10,860\nspeaker2 我说怎么回事\n\n6\n00:00:11,060 --> 00:00:12,596\n曼波 给我发了几张截图\n\n7\n00:00:12,621 --> 00:00:13,310\nspeaker1 我一看\n\n8\n00:00:14,252 --> 00:00:15,615\n原来是昨天\n\n","2 3 4 5",true,"none",true,320,8,2.5,20,157,"fixed",3,6,[false,true]]}],"links":[[52,6,0,37,1,"AUDIO"],[53,35,0,37,0,"VOXCPM_MODEL"],[54,35,0,36,0,"VOXCPM_MODEL"],[61,35,0,40,0,"VOXCPM_MODEL"],[69,37,0,45,0,"VOXCPM_CACHE"],[70,36,0,46,0,"VOXCPM_CACHE"],[71,46,0,47,1,"CACHE_GROUP"],[72,40,0,47,0,"VOXCPM_CACHE"],[100,45,0,46,1,"CACHE_GROUP"],[103,58,0,59,0,"AUDIO"],[106,59,0,36,1,"AUDIO"],[109,35,0,62,0,"VOXCPM_MODEL"],[110,47,0,62,1,"CACHE_GROUP"],[111,62,0,57,0,"AUDIO"],[112,63,0,64,0,"AUDIO"],[113,64,0,40,1,"AUDIO"],[115,56,0,65,0,"AUDIO"],[116,65,0,62,2,"AUDIO"],[117,62,0,66,0,"AUDIO"],[118,62,0,69,0,"AUDIO"]],"groups":[{"id":1,"title":"replace voice or content in an audio","bounding":[-955.7700669596304,85.13781270743623,2254.609522599564,1170.8381580088721],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.9229599817707141,"offset":[769.7220068314273,-87.15566528055818]}},"version":0.4}