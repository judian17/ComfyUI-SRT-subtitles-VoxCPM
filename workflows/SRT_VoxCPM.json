{"id":"1be99ed8-635c-408f-8e0c-5e23567ce902","revision":0,"last_node_id":76,"last_link_id":121,"nodes":[{"id":39,"type":"LoadAudio","pos":[-606.1050025344872,1002.3647155366871],"size":[270,136],"flags":{},"order":0,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["t3.wav",null,null]},{"id":40,"type":"VoxCPM_Cache_Builder","pos":[-285.55866027815347,952.8921231055699],"size":[400,200],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":61},{"localized_name":"prompt_audio","name":"prompt_audio","type":"AUDIO","link":106},{"localized_name":"speaker_name","name":"speaker_name","type":"STRING","widget":{"name":"speaker_name"},"link":null},{"localized_name":"prompt_text","name":"prompt_text","type":"STRING","widget":{"name":"prompt_text"},"link":null}],"outputs":[{"localized_name":"VOXCPM_CACHE","name":"VOXCPM_CACHE","type":"VOXCPM_CACHE","links":[72]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Builder"},"widgets_values":["speaker2","傻子不是人哪？傻子不是爹妈养的？",[false,true]]},{"id":58,"type":"LoadAudio","pos":[-951.3731536953661,692.3225546995989],"size":[270,136],"flags":{},"order":1,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[103]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["long.mp3",null,null]},{"id":59,"type":"Audio_Trimmer_By_Timestamp","pos":[-958.8974532297043,891.6780368529503],"size":[291.7779296875,58],"flags":{},"order":6,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":103},{"localized_name":"timestamp","name":"timestamp","type":"STRING","widget":{"name":"timestamp"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[106]}],"properties":{"Node name for S&R":"Audio_Trimmer_By_Timestamp"},"widgets_values":["00:00:22,750 --> 00:00:27,060"]},{"id":71,"type":"SaveAudio","pos":[-348.66966508320155,271.1748604955335],"size":[270,112],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"AUDIO","link":118},{"localized_name":"文件名前缀","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"SaveAudio"},"widgets_values":["audio/ComfyUI"]},{"id":35,"type":"VoxCPM_Loader","pos":[-897.561493730203,1030.5321261457934],"size":[270,106],"flags":{},"order":2,"mode":0,"inputs":[{"localized_name":"model_name","name":"model_name","type":"COMBO","widget":{"name":"model_name"},"link":null},{"localized_name":"optimize","name":"optimize","type":"BOOLEAN","widget":{"name":"optimize"},"link":null}],"outputs":[{"localized_name":"VOXCPM_MODEL","name":"VOXCPM_MODEL","type":"VOXCPM_MODEL","links":[53,54,61,112]}],"properties":{"Node name for S&R":"VoxCPM_Loader"},"widgets_values":["VoxCPM-0.5B",false]},{"id":68,"type":"LoadAudio","pos":[-945.2478972398168,258.57176199665093],"size":[270,136],"flags":{},"order":3,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[115]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["1-你骂我是你有病-1080P 高清-AVC.mp3",null,null]},{"id":69,"type":"Audio_Trimmer_By_Timestamp","pos":[-966.0338631382867,557.8946395723789],"size":[291.7779296875,58],"flags":{},"order":7,"mode":0,"inputs":[{"localized_name":"audio","name":"audio","type":"AUDIO","link":115},{"localized_name":"timestamp","name":"timestamp","type":"STRING","widget":{"name":"timestamp"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[117,118]}],"properties":{"Node name for S&R":"Audio_Trimmer_By_Timestamp"},"widgets_values":["00:00:07,050 --> 00:00:11,760"]},{"id":36,"type":"VoxCPM_Cache_Builder","pos":[-284.8752683209636,671.97389878576],"size":[400,200],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":54},{"localized_name":"prompt_audio","name":"prompt_audio","type":"AUDIO","link":117},{"localized_name":"speaker_name","name":"speaker_name","type":"STRING","widget":{"name":"speaker_name"},"link":null},{"localized_name":"prompt_text","name":"prompt_text","type":"STRING","widget":{"name":"prompt_text"},"link":null}],"outputs":[{"localized_name":"VOXCPM_CACHE","name":"VOXCPM_CACHE","type":"VOXCPM_CACHE","links":[70]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Builder"},"widgets_values":["说话人","我骂你，你没有病我能骂你吗？对不对？咱讲道理是不是。",[false,true]]},{"id":37,"type":"VoxCPM_Cache_Builder","pos":[-273.8319551164853,447.254717607399],"size":[402.01824998479754,137],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":53},{"localized_name":"prompt_audio","name":"prompt_audio","type":"AUDIO","link":52},{"localized_name":"speaker_name","name":"speaker_name","type":"STRING","widget":{"name":"speaker_name"},"link":null},{"localized_name":"prompt_text","name":"prompt_text","type":"STRING","widget":{"name":"prompt_text"},"link":null}],"outputs":[{"localized_name":"VOXCPM_CACHE","name":"VOXCPM_CACHE","type":"VOXCPM_CACHE","links":[69]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Builder"},"widgets_values":["speaker1","西风骑士团火花骑士可莉，前来报到！",[false,true]]},{"id":47,"type":"VoxCPM_Cache_Combiner","pos":[138.41246221858344,952.425886137512],"size":[279.5611328125,46],"flags":{},"order":14,"mode":0,"inputs":[{"localized_name":"cache_item","name":"cache_item","type":"VOXCPM_CACHE","link":72},{"localized_name":"cache_group","name":"cache_group","shape":7,"type":"CACHE_GROUP","link":71}],"outputs":[{"localized_name":"CACHE_GROUP","name":"CACHE_GROUP","type":"CACHE_GROUP","links":[119]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Combiner"},"widgets_values":[]},{"id":46,"type":"VoxCPM_Cache_Combiner","pos":[157.854914403062,690.7658031726403],"size":[279.5611328125,46],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"cache_item","name":"cache_item","type":"VOXCPM_CACHE","link":70},{"localized_name":"cache_group","name":"cache_group","shape":7,"type":"CACHE_GROUP","link":100}],"outputs":[{"localized_name":"CACHE_GROUP","name":"CACHE_GROUP","type":"CACHE_GROUP","links":[71]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Combiner"},"widgets_values":[]},{"id":45,"type":"VoxCPM_Cache_Combiner","pos":[159.0939978560659,467.0115838010279],"size":[279.5611328125,46],"flags":{},"order":12,"mode":0,"inputs":[{"localized_name":"cache_item","name":"cache_item","type":"VOXCPM_CACHE","link":69},{"localized_name":"cache_group","name":"cache_group","shape":7,"type":"CACHE_GROUP","link":null}],"outputs":[{"localized_name":"CACHE_GROUP","name":"CACHE_GROUP","type":"CACHE_GROUP","links":[100]}],"properties":{"Node name for S&R":"VoxCPM_Cache_Combiner"},"widgets_values":[]},{"id":65,"type":"VoxCPM_SRT_Processor","pos":[457.6522449111971,711.8801475481912],"size":[418.7144920840333,519.745990137103],"flags":{},"order":15,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"VOXCPM_MODEL","link":112},{"localized_name":"cache_group","name":"cache_group","type":"CACHE_GROUP","link":119},{"localized_name":"srt_text","name":"srt_text","type":"STRING","widget":{"name":"srt_text"},"link":null},{"localized_name":"normalize_text","name":"normalize_text","type":"BOOLEAN","widget":{"name":"normalize_text"},"link":null},{"localized_name":"stretch_method","name":"stretch_method","type":"COMBO","widget":{"name":"stretch_method"},"link":null},{"localized_name":"stretch_n_fft","name":"stretch_n_fft","type":"INT","widget":{"name":"stretch_n_fft"},"link":null},{"localized_name":"stretch_hop_length","name":"stretch_hop_length","type":"INT","widget":{"name":"stretch_hop_length"},"link":null},{"localized_name":"keep_model_loaded","name":"keep_model_loaded","type":"BOOLEAN","widget":{"name":"keep_model_loaded"},"link":null},{"localized_name":"cfg_value","name":"cfg_value","type":"FLOAT","widget":{"name":"cfg_value"},"link":null},{"localized_name":"inference_timesteps","name":"inference_timesteps","type":"INT","widget":{"name":"inference_timesteps"},"link":null},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null},{"localized_name":"retry_max_attempts","name":"retry_max_attempts","type":"INT","widget":{"name":"retry_max_attempts"},"link":null},{"localized_name":"retry_threshold","name":"retry_threshold","type":"FLOAT","widget":{"name":"retry_threshold"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[113]}],"properties":{"Node name for S&R":"VoxCPM_SRT_Processor"},"widgets_values":["1\n00:00:00,500 --> 00:00:05,000\nspeaker1 这是第一句话。注意建议都加上标点符号不然断句可能有问题。\n\n2\n00:00:05,300 --> 00:00:07,000\nspeaker2 这是第二句话，短一点。\n\n3\n00:00:07,500 --> 00:00:10,000\n说话人 这是第三句话。\n\n",true,"pydub",320,8,true,2,15,102,"fixed",3,6,[false,true]]},{"id":6,"type":"LoadAudio","pos":[-635.584427695343,438.4988253015889],"size":[270,136],"flags":{},"order":4,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"COMBO","widget":{"name":"audio"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null},{"localized_name":"选择文件上传","name":"upload","type":"AUDIOUPLOAD","widget":{"name":"upload"},"link":null}],"outputs":[{"localized_name":"音频","name":"AUDIO","type":"AUDIO","links":[52]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"LoadAudio"},"widgets_values":["可莉3.mp3",null,null]},{"id":22,"type":"Note","pos":[459.8823087197566,297.32014112038263],"size":[614.5590236834444,319.3681535256312],"flags":{},"order":5,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["VoxCPM loader节点的optimize参数用于启用torch compiler，但是直接用用不了，可能Linux能用吧故保留。若提示：\nRuntimeError: cudaMallocAsync does not yet support checkPoolLiveAllocations. If you need it, please file an issue describing your use case.\n请查看是不是不小心打开了。\n\nVoxCPM cache builder的speaker_name 为手动输入说话人编号，与srt文件中每句话前对应的说话人一致。文本输入框中输入参考音频的说话内容。输出的voxcpm_cache 连接到vocpm cache combiner节点，此节点可以复制不断串联以增加说话人。第一个节点的cache_group不需要输入，后续每一个的输入与前一个输出相连，最后一个连到srt processor节点。srt字幕中的每句话前请使用 字符串+空格的格式区分说话人，例如：\n1\n00:00:00,500 --> 00:00:05,000\nspeaker1 Hello world！\n\n2\n00:00:06,500 --> 00:00:08,000\n说话人 你好，世界！\n\n当想处理单人srt字幕时，srt字幕中文本不需要加说话人前缀。例如：\n1\n00:00:00,500 --> 00:00:05,000\nHello world！\n\n2\n00:00:06,500 --> 00:00:08,000\n你好，世界！\n\n可使用 comfyui \"加载音频\"节点加载参考音频输入给cache builder节点，也可加载完整长音频，输入给 audio trimmer by timestamp节点，在节点上输入形如00:00:06,500 --> 00:00:08,000的时间戳文本，即可仅输出此时间段的音频。\n\nnormalize text参数用于正则化文本，例如输入数字50时，不开启可能会读成五零，开启可读成五十。\n\nstretch method的三种模式：\n  none代表不加速音频，当生成音频超出原始时间段长度，与下一句重合时，两句话会同时存在；\n  librosa 代表使用librosa加速音频使其长度与文本时长一致。此加速方法效果时好时坏，可通过调整stretch n fft与 stretch hop length来改善“金属声”等效果。\n  pydub 代表使用pydub方法加速音频使其长度与文本时长一致。此方法效果略好于librosa，但需要下载ffmpeg并设置环境变量，本方法本质是借助ffmpeg处理音频。ffmpeg安装及环境变量设置可参考此处：https://blog.csdn.net/Natsuago/article/details/143231558\n\nkeep model loaded开启则运行后保留显存占用，关闭则清理显存。但是我时间与技术受限，当前无法完全清理，剩下1G怎么也清理不掉，不过使用comfyui manager 节点的free model and node cache按钮可以手动清空一部分，还会剩余0.3g清不掉。希望有社区大佬优化吧。\n\n\n默认CFG=2比较正常一些，较大的CFG虽然在某些情况下能够提升生成的following效果，但是会导致潜在的不稳定性，详情可见项目作者的技术报告中关于CFG的实验部分：https://arxiv.org/pdf/2509.24650\n\ninference timesteps 10步即可有较好效果，增加步数可得到更好的效果\n\nretry_threshold (重试阈值):这是触发重试的条件。voxcpm 会比较生成音频的长度和输入文本的长度。如果生成的音频相对于文本来说“过长”，模型就认为自己“卡住”了（即在“胡言乱语”）。如果参考音频为一个语速非常慢的说话人（例如戏剧性的停顿）生成语音，可能需要调高这个值（比如到 8.0 或 10.0），以防止模型误以为正常的慢速语音是“坏”的。\nretry_max_attempts (最大重试次数):这是在触发“坏情况”后，模型允许自己重试多少次。当 audio_text_ratio 超过 retry_threshold 时，模型会丢弃这一次生成的坏音频，并从头开始（使用不同的随机性）为同一句文本再次尝试生成。\n\n何时调整： 默认值 3 通常足够了。如果设为 0，则会禁用此功能（即使检测到坏情况也不会重试）。\n\n"],"color":"#432","bgcolor":"#653"},{"id":15,"type":"SaveAudio","pos":[927.9294980345318,699.009632921297],"size":[283.4549177758479,117.38195889805911],"flags":{},"order":16,"mode":0,"inputs":[{"localized_name":"音频","name":"audio","type":"AUDIO","link":113},{"localized_name":"文件名前缀","name":"filename_prefix","type":"STRING","widget":{"name":"filename_prefix"},"link":null},{"localized_name":"音频UI","name":"audioUI","type":"AUDIO_UI","widget":{"name":"audioUI"},"link":null}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.66","Node name for S&R":"SaveAudio"},"widgets_values":["audio/vox"]}],"links":[[52,6,0,37,1,"AUDIO"],[53,35,0,37,0,"VOXCPM_MODEL"],[54,35,0,36,0,"VOXCPM_MODEL"],[61,35,0,40,0,"VOXCPM_MODEL"],[69,37,0,45,0,"VOXCPM_CACHE"],[70,36,0,46,0,"VOXCPM_CACHE"],[71,46,0,47,1,"CACHE_GROUP"],[72,40,0,47,0,"VOXCPM_CACHE"],[100,45,0,46,1,"CACHE_GROUP"],[103,58,0,59,0,"AUDIO"],[106,59,0,40,1,"AUDIO"],[112,35,0,65,0,"VOXCPM_MODEL"],[113,65,0,15,0,"AUDIO"],[115,68,0,69,0,"AUDIO"],[117,69,0,36,1,"AUDIO"],[118,69,0,71,0,"AUDIO"],[119,47,0,65,1,"CACHE_GROUP"]],"groups":[{"id":1,"title":"generate audio by srt-subtitles and reference audio","bounding":[-1009.3583297738217,147.65778928894747,2271.2083284762234,1132.1366247504802],"color":"#3f789e","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":1.1167815779425663,"offset":[415.7856516202662,-398.9144415976084]}},"version":0.4}